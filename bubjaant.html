<script>
(() => {
  const img = document.getElementById('hero');
  const quickPill = document.querySelector('.quick-pill');
  const mainActionBtn = document.getElementById('mainActionBtn'); // ✅ 추가

  // ✅ 메인 버튼 클릭 시: 이동 막고 알림만 띄우기
  if (mainActionBtn) {
    mainActionBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      alert('종료된 이벤트입니다.');
    });
  }

  if (!img) return;

  const MAX_SCALE_Y = 1.03;
  const TRIGGER_START = 0.80;

  let baseHeight = null;

  img.addEventListener("load", () => {
    baseHeight = img.naturalHeight / (img.naturalWidth / img.offsetWidth);
  });

  let ticking = false;

  // ===== ✅ 퀵알약: 스크롤 방향 감지(누적 기준) =====
  let lastScrollTop = window.scrollY || window.pageYOffset;
  let pillHidden = false;

  const DIR_DELTA = 4;         
  const TOP_ALWAYS_SHOW = 8;

  const HIDE_AFTER = 80;       
  const SHOW_AFTER = 18;       

  let downAcc = 0;
  let upAcc = 0;

  function setPillVisible(visible){
    if (!quickPill) return;

    if (visible) {
      if (!pillHidden) return;
      quickPill.classList.remove('is-hidden');
      pillHidden = false;
    } else {
      if (pillHidden) return;
      quickPill.classList.add('is-hidden');
      pillHidden = true;
    }
  }

  function onScroll() {
    if (!baseHeight && img.complete) {
      baseHeight = img.naturalHeight / (img.naturalWidth / img.offsetWidth);
    }

    if (ticking) return;
    ticking = true;

    requestAnimationFrame(() => {
      const scrollTop = window.scrollY || window.pageYOffset;
      const doc = document.documentElement;
      const docHeight = doc.scrollHeight;
      const winHeight = window.innerHeight;

      // ===== (기존) 이미지 하단 늘림 =====
      if (baseHeight) {
        const progress = (scrollTop + winHeight) / docHeight;

        if (progress >= TRIGGER_START) {
          const t = Math.min(1, (progress - TRIGGER_START) / (1 - TRIGGER_START));
          const eased = t < 0.5 ? 2*t*t : 1 - Math.pow(-2*t+2, 2)/2;
          const scaleY = 1 + (MAX_SCALE_Y - 1) * eased;
          img.style.height = (baseHeight * scaleY) + "px";
        } else {
          img.style.height = baseHeight + "px";
        }
      }

      // ===== ✅ 퀵알약: 다운스크롤 숨김 / 업스크롤 표시(누적 기준) =====
      const diff = scrollTop - lastScrollTop;

      if (scrollTop <= TOP_ALWAYS_SHOW) {
        setPillVisible(true);
        downAcc = 0; upAcc = 0;
      } else if (Math.abs(diff) >= DIR_DELTA) {
        if (diff > 0) {
          downAcc += diff;
          upAcc = 0;
          if (downAcc >= HIDE_AFTER) setPillVisible(false);
        } else {
          upAcc += (-diff);
          downAcc = 0;
          if (upAcc >= SHOW_AFTER) setPillVisible(true);
        }
      }

      lastScrollTop = scrollTop;
      ticking = false;
    });
  }

  window.addEventListener('scroll', onScroll, { passive: true });
  window.addEventListener('resize', onScroll);
  onScroll();
})();
</script>
